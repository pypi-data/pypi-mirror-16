<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
  <head>
    <title>Matterhorn - streamsetup</title>
    <link href="/css/styles.css"  type=text/css rel=stylesheet>
    <link href="/css/matterhorn_v2u_embedded.css" type=text/css rel=stylesheet>
    <link href="/css/matterhorn.css" type=text/css rel=stylesheet>

    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.jeditable.mini.js"></script>
    <script type="text/javascript" src="/admin/js/updater.js"></script>
    <script type="text/javascript" src="/admin/js/forms.js"></script>
  </head>

  <body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" id="topbanner">
  <tr>
    <td valign="bottom" width="1"><a href="http://www.opencastproject.org/project/matterhorn" style="outline-style: none" target="_blank"><img src="/images/matterhorn_logo.png" alt="matterhorn" title="matterhorn main page" border="0"/></a></td>
    <td VALIGN="center" align="center" id="systemdescr"></td>
    <td VALIGN="center" align="right" class="productname">
        Matterhorn    </td>
  </tr>
</table>
      <div class="wrapper">
<div class="role" ><span class="role-name">Administrator</span><a href="/logout.cgi" class="role-logout" id="logout-button"></a></div><div style="height:30px"></div>           <div class="wrapper_content">
      <div id="nav_column">
<div class="category_1"><h1>Channels</h1><style type="text/css">

div.navmenu a.simple {
	color: blue;
	background: none;
    border-bottom:0px dashed blue;
}

</style>

<div class="category_1">
<div class="category_2" id="1"><h1><span style="color:#808080">&nbsp;1.</span> <a id="menu_channel_1" href="/admin/channel1/streamsetup">dce-pr</a></h1>
<div class="navmenu">
<a href="/admin/channel1/status">Status</a>
<a href="/admin/channel1/mediasources">Sources</a>
<a href="/admin/channel1/codecsetup">Encoding</a>
<a href="/admin/channel1/streambranding">Branding</a>
<div id="navmenucurrent"><a href="/admin/channel1/streamsetup">Streaming</a></div>
<a href="/admin/channel1/archive">Recording</a>
</div>
</div>
<div class="category_2" id="2"><h1><span style="color:#808080">&nbsp;2.</span> <a id="menu_channel_2" href="/admin/channel2/streamsetup">dce-pn</a></h1>
</div>
<div class="category_2" id="3"><h1><span style="color:#808080">&nbsp;3.</span> <a id="menu_channel_3" href="/admin/channel3/streamsetup">dce-live</a></h1>
</div>
<div class="category_2" id="4"><h1><span style="color:#808080">&nbsp;4.</span> <a id="menu_channel_4" href="/admin/channel4/streamsetup">dce-pr</a></h1>
</div>
<div class="navmenu"><a class="simple" href="/admin/add_channel.cgi"><nobr>Add channel</nobr></a></div></div>
</div><div class="category_1"><h1>Recorders</h1><style type="text/css">

div.navmenu a.simple {
	color: blue;
	background: none;
    border-bottom:0px dashed blue;
}

</style>

<div class="category_1"><div class="category_2"><h1><span style="color:#808080">&nbsp;2.</span> <a id="menu_mrecorder_2" href="/admin/recorder2/archive">Recorder 2</a></h1></div><div class="category_2"><h1><span style="color:#C0C0C0">&nbsp;3.</span> <a id="menu_mrecorder_3" href="/admin/recorder3/archive">Recorder naomi 3</a></h1></div><div class="navmenu"><a class="simple" href="/admin/add_recorder.cgi"><nobr>Add recorder</nobr></a></div></div></div><div class="category_1"><h1>Sources</h1><style type="text/css">

div.navmenu a.simple {
    color: blue;
    background: none;
    border-bottom:0px dashed blue;
}

</style>

<div class="navmenu"><div><a id='menu_dev_D2P280762.hdmi-a' href="/admin/sources/D2P280762.hdmi-a">HDMI-A</a></div><div><a id='menu_dev_D2P280762.hdmi-b' href="/admin/sources/D2P280762.hdmi-b">HDMI-B</a></div><div><a id='menu_dev_D2P280762.sdi-a' href="/admin/sources/D2P280762.sdi-a">SDI-A</a></div><div><a id='menu_dev_D2P280762.sdi-b' href="/admin/sources/D2P280762.sdi-b">SDI-B</a></div><div><a id='menu_dev_D2P280762.vga-a' href="/admin/sources/D2P280762.vga-a">VGA-A</a></div><div><a id='menu_dev_D2P280762.vga-b' href="/admin/sources/D2P280762.vga-b">VGA-B</a></div><div><a id='menu_dev_D2P280762.analog-a' href="/admin/sources/audio_D2P280762.analog-a">Analog-A Audio</a></div><div><a id='menu_dev_D2P280762.analog-b' href="/admin/sources/audio_D2P280762.analog-b">Analog-B Audio</a></div><div><a id='menu_dev_D2P280762.hdmi-a-audio' href="/admin/sources/audio_D2P280762.hdmi-a-audio">HDMI-A Audio</a></div><div><a id='menu_dev_D2P280762.hdmi-b-audio' href="/admin/sources/audio_D2P280762.hdmi-b-audio">HDMI-B Audio</a></div><div><a id='menu_dev_D2P280762.sdi-a-audio' href="/admin/sources/audio_D2P280762.sdi-a-audio">SDI-A Audio</a></div><div><a id='menu_dev_D2P280762.sdi-b-audio' href="/admin/sources/audio_D2P280762.sdi-b-audio">SDI-B Audio</a></div></div></div>        <div class="category_1"><h1>Configuration</h1>
          <div class="navmenu">
          <a href="/admin/mhcfg">Matterhorn Server</a>
          <a href="/admin/afucfg">Automatic File Upload</a>
          <a href="/admin/usbdrivecfg">External USB drive</a>
          <a href="/admin/ftpaccesscfg">FTP Server</a>
          <a href="/admin/upnp">UPnP</a>
          <a href="/admin/networkcfg">Network</a>
          <a href="/admin/timesynccfg">Date and Time</a>
          <a href="/admin/accesscfg">Access passwords</a>
          <a href="/admin/touchscreencfg">Touch Screen</a>
          <a href="/admin/serialcfg">Serial Port</a>
          <a href="/admin/cms">Branding Content</a>
          <a href="/admin/maintenancecfg">Maintenance</a>
          <a href="/admin/diskcheckcfg">Disk check</a>
          <a href="/admin/firmwarecfg">Firmware Upgrade</a>
          <a href="/admin/infocfg">Info</a>
          </div>
        </div>
<div class="category_1"><h1>Internal storage</h1>
Total: 929.85 GB<br/>
Used: 0.09 GB<br/>
Free: 929.76 GB<br/>
<table cellpadding="0" cellspacing="0" id="graph" style="width:100%">
  <tr>
    <td width="0%" id="red_graph"></td>
    <td width="100%" align="center" id="green_graph">100%</td>
  </tr>
</table>
</div>      </div>
      <div id=main_win>
      <div id="global_message_banner"></div><h1><span class='editable_in_place' style='color:#B0B0B0' id='channelname'>dce-pr</span> &rarr; Streaming</h1>
		<script type="text/javascript">
		
		$(document).ready(function() {
						  var channel = "1";
						  $('#channelname').editable( '/admin/ajax/rename_channel.cgi',
						  	{
								width : 'none',
								submitdata : {channel: channel},
								callback : function(newname) {
									$('#menu_channel_' + channel).html(newname);
								},
							}
							);
		});
		
		</script>
		<form name="mainForm" id="mainForm" action="" method="POST" onsubmit="forms_prepare_submit('mainForm'); return true;"><input id="mainForm_pfd_form_id" name="pfd_form_id" type="hidden" value="mainForm"><table class="forms_table"><tbody id="bcast"><tr><td colspan="2"><h2 style="padding:0 0 0 2em;margin-bottom: 0px;">Streams for viewers</h2></td></tr><tr><td colspan="2" style="padding-bottom: 16px; padding-left: 40px; font-style: italic;">Configure this option when viewers access the stream.</td></tr><tr id="line_bcast_enabled"><td class="forms_tdtitle" valign="top">&nbsp;</td><td><input type="checkbox" name="bcast_enabled" id="bcast_enabled" value="" checked="checked" />&nbsp;<input type="hidden" name="bcast_enabled" id="bcast_enabled_unchecked" value="on" /><label style="display:inline; text-decoration:none; font-weight:normal; width:100%; margin-top:0;" for="bcast_enabled">Enabled</label></td></tr><tr id="line_httpport"><td class="forms_tdtitle" valign="top"><nobr>HTTP streaming port:</nobr></td><td><input id="httpport" name="httpport" type="text" maxlength="5" size="5" value="8000"></td></tr><tr id="line_rtspport"><td class="forms_tdtitle" valign="top"><nobr>RTSP streaming port:</nobr></td><td><input id="rtspport" name="rtspport" type="text" maxlength="5" size="5" value="554" placeholder="554"></td></tr><tr id="line_bcast_hls"><td class="forms_tdtitle" valign="top">&nbsp;</td><td><input type="checkbox" name="bcast_hls" id="bcast_hls" value="on"  />&nbsp;<input type="hidden" name="bcast_hls" id="bcast_hls_unchecked" value="" /><label style="display:inline; text-decoration:none; font-weight:normal; width:100%; margin-top:0;" for="bcast_hls">HTTP Live Streaming</label></td></tr><tr id="line_bcast_upnp"><td class="forms_tdtitle" valign="top">&nbsp;</td><td><input type="checkbox" name="bcast_upnp" id="bcast_upnp" value="on"  />&nbsp;<input type="hidden" name="bcast_upnp" id="bcast_upnp_unchecked" value="" /><label style="display:inline; text-decoration:none; font-weight:normal; width:100%; margin-top:0;" for="bcast_upnp">Share via UPnP</label></td></tr><tr id="line_upnp_fixers"><td class="forms_tdtitle" valign="top">&nbsp;</td><td><span id="upnp_fixers" class="forms_warning">UPnP live video sharing is not enabled for this device<span id="fix_upnp_archive" class="pseudo_href forms_fix_link">to fix it, click here</span><span id="fixed_upnp_archive" class="forms_fixed_issue">&mdash; will be fixed</span></span></td></tr><input id="svc_upnp_enabled" name="svc_upnp_enabled" type="hidden" value="" /></tbody><tbody id="access"><tr><td colspan="2"><h3 style="padding:3em 0 0 2em;">Stream access control</h3></td></tr><tr id="line_ac_override"><td class="forms_tdtitle" valign="top">&nbsp;</td><td><select id="ac_override" name="ac_override"><option value=""  SELECTED>Use global settings</option>
<option value="on" >Use these settings</option>
</select></td></tr><tr id="line_ac_viewerpwd"><td class="forms_tdtitle" valign="top"><nobr>Viewer password:</nobr></td><td><input id="ac_viewerpwd" name="ac_viewerpwd" type="password" maxlength="64" size="20" value=""></td></tr><tr id="line_ac_allowip"><td class="forms_tdtitle" valign="top"><nobr>Allow IP's:</nobr></td><td><input id="ac_allowip" name="ac_allowip" type="text" maxlength="128" size="50" value="">&nbsp;</td></tr><tr id="line_ac_denyip"><td class="forms_tdtitle" valign="top"><nobr>Deny IP's:</nobr></td><td><input id="ac_denyip" name="ac_denyip" type="text" maxlength="128" size="50" value="">&nbsp;</td></tr></tbody><tbody id="publish"><tr><td colspan="2"><h2 style="padding:3em 0 0 2em;margin-bottom: 0px;">Stream to a server</h2></td></tr><tr><td colspan="2" style="padding-bottom: 16px; padding-left: 40px; font-style: italic;">Configure this option to stream via multi-cast, CDNs and streaming servers.</td></tr><tr id="line_profile_xml_file"><td class="forms_tdtitle" valign="top"><nobr>Use profile XML:</nobr></td><td><input type="file" name="profile_xml_file" id="profile_xml_file" /></td></tr><tr id="line_publish_type"><td class="forms_tdtitle" valign="top"><nobr>Publish:</nobr></td><td><select id="publish_type" name="publish_type"><option value="0"  SELECTED>Disabled</option>
<option value="1" >ed72ed0d_channel1.epiphan.tv</option>
<option value="2" >RTSP announce</option>
<option value="6" >RTMP push</option>
<option value="3" >RTP/UDP push</option>
<option value="4" >MPEG-TS UDP push</option>
<option value="5" >MPEG-TS RTP/UDP push</option>
<option value="7" >Wowza Streaming Cloud</option>
<option value="8" >Original Livestream</option>
</select></td></tr><input id="pip_layout" name="pip_layout" type="hidden" value="" /><input id="vgadvi_vbitrate" name="vgadvi_vbitrate" type="hidden" value="" /><input id="video_vbitrate" name="video_vbitrate" type="hidden" value="" /><input id="codec" name="codec" type="hidden" value="h.264" /><input id="vgadvi" name="vgadvi" type="hidden" value="" /><input id="apreset" name="apreset" type="hidden" value="libfaac;44100" /><input id="audio_bitrate" name="audio_bitrate" type="hidden" value="320" /></tbody><tbody id="fixers" style="display:none" ><tr id="line_publish_epiphantv_fixers"><td class="forms_tdtitle" valign="top">&nbsp;</td><td><span id="publish_epiphantv_fixers" class="forms_warning">Automatic video bitrate is not supported for publishing on epiphan.tv (500 kbit/s max)<span id="fix_vgadvi_vbitrate" class="pseudo_href forms_fix_link">fix by set bitrate to 500 kbit/s</span><span id="fixed_vgadvi_vbitrate" class="forms_fixed_issue">&mdash; will be fixed by set bitrate to 500 kbit/s</span></span></td></tr></tbody><tbody id="publish_to_epiphan" style="display:none" ></tbody><tbody id="publish_rtsp" style="display:none" ><tr id="line_rtsp_url"><td class="forms_tdtitle" valign="top"><nobr>URL:</nobr></td><td><input id="rtsp_url" name="rtsp_url" type="text" maxlength="255" size="80" value=""></td></tr><tr id="line_announce_by_tcp"><td class="forms_tdtitle" valign="top">&nbsp;</td><td><input type="checkbox" name="announce_by_tcp" id="announce_by_tcp" value="tcp"  />&nbsp;<input type="hidden" name="announce_by_tcp" id="announce_by_tcp_unchecked" value="udp" /><label style="display:inline; text-decoration:none; font-weight:normal; width:100%; margin-top:0;" for="announce_by_tcp">Use TCP for RTP stream</label></td></tr><tr id="line_rtsp_username"><td class="forms_tdtitle" valign="top"><nobr>Username:</nobr></td><td><input id="rtsp_username" name="rtsp_username" type="text" maxlength="49" size="20" value=""></td></tr><tr id="line_rtsp_password"><td class="forms_tdtitle" valign="top"><nobr>Password:</nobr></td><td><input id="rtsp_password" name="rtsp_password" type="password" maxlength="49" size="20" value=""></td></tr></tbody><tbody id="publish_rtmp" style="display:none" ><tr id="line_rtmp_url"><td class="forms_tdtitle" valign="top"><nobr>URL:</nobr></td><td><input id="rtmp_url" name="rtmp_url" type="text" maxlength="255" size="80" value="http://fake-fake.akamai.com"></td></tr><tr id="line_rtmp_stream"><td class="forms_tdtitle" valign="top"><nobr>Stream name:</nobr></td><td><input id="rtmp_stream" name="rtmp_stream" type="text" value="dev-epiphan002-presenter-delivery.stream-1920x540_1_200@355694"></td></tr><tr id="line_rtmp_username"><td class="forms_tdtitle" valign="top"><nobr>Username:</nobr></td><td><input id="rtmp_username" name="rtmp_username" type="text" maxlength="49" size="20" value="superfakeuser"></td></tr><tr id="line_rtmp_password"><td class="forms_tdtitle" valign="top"><nobr>Password:</nobr></td><td><input id="rtmp_password" name="rtmp_password" type="password" maxlength="49" size="20" value="superfakeuser"></td></tr></tbody><tbody id="publish_multicast" style="display:none" ><tr id="line_unicast_address"><td class="forms_tdtitle" valign="top"><nobr>Destination IP:</nobr></td><td><input id="unicast_address" name="unicast_address" type="text" maxlength="24" size="24" value=""></td></tr><tr id="line_unicast_aport"><td class="forms_tdtitle" valign="top"><nobr>Audio port:</nobr></td><td><input id="unicast_aport" name="unicast_aport" type="text" maxlength="5" size="5" value="" placeholder="6000"></td></tr><tr id="line_unicast_vport"><td class="forms_tdtitle" valign="top"><nobr>Video port:</nobr></td><td><input id="unicast_vport" name="unicast_vport" type="text" maxlength="5" size="5" value="" placeholder="6002"></td></tr><tr id="line_unicast_mport"><td class="forms_tdtitle" valign="top"><nobr>Destination port:</nobr></td><td><input id="unicast_mport" name="unicast_mport" type="text" maxlength="5" size="5" value="" placeholder="6004"></td></tr><tr id="line_sap_on"><td class="forms_tdtitle" valign="top">&nbsp;</td><td><input type="checkbox" name="sap_on" id="sap_on" value="on"  />&nbsp;<input type="hidden" name="sap_on" id="sap_on_unchecked" value="" /><label style="display:inline; text-decoration:none; font-weight:normal; width:100%; margin-top:0;" for="sap_on">SAP announcement</label></td></tr><tr id="line_sap_ip"><td class="forms_tdtitle" valign="top"><nobr>SAP announcement IP:</nobr></td><td><input id="sap_ip" name="sap_ip" type="text" maxlength="24" size="24" value="" placeholder="224.2.127.254"></td></tr><tr id="line_sap_channel_no"><td class="forms_tdtitle" valign="top"><nobr>Channel number:</nobr></td><td><input id="sap_channel_no" name="sap_channel_no" type="text" maxlength="3" size="3" value="" placeholder="1"></td></tr><tr id="line_sap_play_group"><td class="forms_tdtitle" valign="top"><nobr>Group name:</nobr></td><td><input id="sap_play_group" name="sap_play_group" type="text" maxlength="256" size="50" value=""></td></tr></tbody><tbody id="publish_wsc" style="display:none" ><tr><td class="forms_tdtitle" valign="top">&nbsp;</td><td><div class="wui-message-banner wui-message-warning"><div class="wui-message-banner-outer"><div class="wui-message-banner-inner">Your Wowza settings will affect this channel's encoding settings. It is recommended you use this channel only for streaming to Wowza. To record or locally stream, create a duplicate channel.</div></div></div></td></tr><tr id="line_wc_connection_code"><td class="forms_tdtitle" valign="top"><nobr>Connection code:</nobr></td><td><span><input id="wc_connection_code" name="wc_connection_code" type="text" maxlength="6" size="6"><input class="apply_button" id="wc_connection_code_button" type="button" value="Set" onclick="return wc_command('1','validate','wc_validate_result')"><span id="wc_validate_result"></span></span></td></tr><tr id="line_wc_stream_info"><td class="forms_tdtitle" valign="top"><nobr>Current stream:</nobr></td><td><span id="wc_stream_info" class="wui-message-notice"></span>&nbsp;<input class="apply_button" id="wc_stream_info_button" type="button" value="Remove" onclick="return wc_command('1','remove','wc_stream_info')"></span></td></tr><tr id="line_wc_stream_state"><td class="forms_tdtitle" valign="top"><nobr>Transcoder state:</nobr></td><td><span id="wc_stream_state" class="wui-message-notice"></span>&nbsp;<input class="apply_button" id="wc_stream_state_start_button" type="button" value="Start" onclick="return wc_command('1','start','wc_startstop_result')"><input class="apply_button" id="wc_stream_state_stop_button" type="button" value="Stop" onclick="return wc_command('1','stop','wc_startstop_result')"><span id="wc_startstop_result"></span></span></td></tr></tbody><tbody id="publish_livestream" style="display:none" ><tr id="line_livestream_channel_name"><td class="forms_tdtitle" valign="top"><nobr>Short channel name:</nobr></td><td><input id="livestream_channel_name" name="livestream_channel_name" type="text" value=""></td></tr><tr id="line_livestream_username"><td class="forms_tdtitle" valign="top"><nobr>Username:</nobr></td><td><input id="livestream_username" name="livestream_username" type="text" maxlength="49" size="20" value=""></td></tr><tr id="line_livestream_password"><td class="forms_tdtitle" valign="top"><nobr>Password:</nobr></td><td><input id="livestream_password" name="livestream_password" type="password" maxlength="49" size="20" value=""></td></tr></tbody><tr><td></td><td><input class="apply_button"  id="apply_mainForm" type="submit" value="Apply"></td></tr></table></form>
<script type='text/javascript'>
// UI scripts

var current_publish_type = 0;
var wc_info_timer;

function updateAccessControlUI()
{
  if ($('#access'))
  {
      var streaming  = $('#bcast_enabled').prop('checked');
      var overrideAC = $('#ac_override').val() == 'on';
      
      forms_enable_line('ac_override',   streaming);
      forms_enable_line('ac_viewerpwd',  streaming && overrideAC);
      forms_enable_line('ac_allowip',    streaming && overrideAC);
      forms_enable_line('ac_denyip',     streaming && overrideAC);
  }
}

function updateUI()
{
  var streaming  = $('#bcast_enabled').prop('checked');

  forms_enable_line('httpport', streaming);
  forms_enable_line('rtspport', streaming);
  forms_enable_line('bcast_hls', streaming);
  forms_enable_line('bcast_upnp', streaming);

  if ($('#bcast_upnp'))
    forms_show_value_fixer('upnp_fixers',  $('#bcast_upnp').prop('checked'));
  
  updateAccessControlUI();
}

$('#bcast_enabled').change(updateUI);
if ($('#ac_override')) $('#ac_override').change(updateAccessControlUI);
if ($('#bcast_upnp'))  $('#bcast_upnp').change(updateUI);

// Publishing

function updatePublishUI()
{
    var publish_type = $('#publish_type').val();
	
    forms_show_value_fixer('publish_common_fixers',     publish_type != 0);
    forms_show_value_fixer('publish_epiphantv_fixers',  publish_type == 1);
    forms_show_value_fixer('publish_rtmp_fixers',  publish_type == 6 || publish_type == 8);
    forms_show_value_fixer('publish_wc_fixers',  publish_type == 7);

    
    forms_show_section('fixers', true);
    forms_show_section('publish_to_epiphan',    publish_type == 1);
    forms_show_section('publish_rtsp', publish_type == 2);
    forms_show_section('publish_rtmp', publish_type == 6);
    forms_show_section('publish_multicast',     publish_type == 3 || publish_type == 4 || publish_type == 5);
    forms_show_section('publish_wsc', publish_type == 7);
    forms_show_section('publish_livestream', publish_type == 8);
    
    forms_show_section_line('unicast_aport',    publish_type == 3);
    forms_show_section_line('unicast_vport',    publish_type == 3);
    forms_show_section_line('unicast_aport',    publish_type == 3);
    forms_show_section_line('unicast_mport',    publish_type == 4 || publish_type == 5);
    forms_show_section_line('sap_on',           publish_type == 4 || publish_type == 5);
    forms_show_section_line('sap_ip',           publish_type == 4 || publish_type == 5);
    forms_show_section_line('sap_channel_no',   publish_type == 4 || publish_type == 5);
    forms_show_section_line('sap_play_group',   publish_type == 4 || publish_type == 5);
    forms_show_section_line('wc_connection_code', current_publish_type == 7 && publish_type == 7);
    forms_show_section_line('wc_stream_info',   current_publish_type == 7 && publish_type == 7);
    forms_show_section_line('wc_stream_state',   current_publish_type == 7 && publish_type == 7);
    if(publish_type == 7 && current_publish_type == 7) {
        wc_command('1','info','wc_stream_info');
    }
    else {
        clearTimeout(wc_info_timer);
    }
}

$('#publish_type').change(updatePublishUI);

forms_register_value_fixer('vgadvi_vbitrate',{vgadvi_vbitrate: '500',});
forms_register_value_fixer('upnp_archive',{svc_upnp_enabled: 'on',});

// In-browser encoder profile reader.

function handleFileSelect(event)
{
    function reportProfileError(err)
    {
        alert(err);
    }
    
    var file = event.target.files[0];
    
    if( file.type == "text/xml" )
    {
        var reader = new FileReader();
        reader.onload = function(e)
        {
            try
            {
                var xmlDoc = $.parseXML(e.target.result);
                var xml = $( xmlDoc );
                var encoder_node = xml.find("encoder_profile");
                if (!encoder_node.length)
                    encoder_node = xml.find("flashmedialiveencoder_profile");

                var output_node = encoder_node.length > 0 ? encoder_node.find ("output") : xml.find("output");
                if (!output_node.length)
                    throw "Unsupported CDN profile";
                
                // RTMP configuration section
                var rtmp_node = output_node.find("rtmp");
                if (rtmp_node.length)
                {
                    var rtmp_url = rtmp_node.find("url").text();
                    if (!rtmp_url)
                        throw "Unsupported CDN profile";
                    
                    var stream = rtmp_node.find("stream").text();
                    if( stream )
                    {
                        var username = rtmp_node.find("username").text();
                        var password = rtmp_node.find("password").text();
                    }
                    
                    $('#publish_type').val(6);
                    $('#rtmp_url').val(rtmp_url);
                    $('#rtmp_stream').val(stream);
                    $('#rtmp_username').val(username);
                    $('#rtmp_password').val(password);
                
                    updatePublishUI();
                }
                else
                {
                    throw "Unsupported CDN profile";
                }
            }
            catch(err)
            {
                reportProfileError("Invalid or unsupported CDN profile");
            }
        }
        
        reader.readAsText(file);
    }
    else
    {
        reportProfileError("Unsupported CDN profile");
    }
}

$('#profile_xml_file').bind('change', handleFileSelect);

function wc_command(channel,cmd,result_name, noprogress) 
{
    var publish_type = $('#publish_type').val();
    if( publish_type != 7 ) return;
    var result = document.getElementById(result_name);
    var connection_code = document.getElementById('wc_connection_code');
    var wc_state = document.getElementById('wc_stream_state');
    var msg = "";
    /* Create a FormData instance */
    var formData = new FormData();
    switch(cmd) {
	case "validate":
        if(!connection_code.value) return;
        formData.append("code",connection_code.value);
        msg = "Validating";
        break;
	case "remove":
        msg = "Working...";
        break;
	case "info":
        msg = "Retreiving...";
        break;
	case "start":
        msg = "Starting...";
        break;
	case "stop":
        msg = "Stopping...";
        break;
	default:
        return;
    }
    if(!noprogress) {
        result.innerHTML = "<img src='/images/progress.gif'>"+msg;
    }
    formData.append("command",cmd);
    formData.append("channel",channel);

    clearTimeout(wc_info_timer);
    $.ajax({
        url:'/admin/wsc.cgi',
                data:formData,
                cache: false,
                processData: false,
                contentType: false,
                type:'POST',
                success:function (data, status, req) {
			switch(cmd) {
			case "validate":
                    		connection_code.value="";
			case "remove":
				if(data.error) {
				        result.innerHTML = data.error;
                }
                else {
				        result.innerHTML = "";
				}
		        wc_command(channel,'info','wc_stream_info');
				break;
			case "info":
				if(data.error) {
					result.innerHTML = data.error;
					wc_state.innerHTML = 'N/A';
				}
				else {
		                	result.innerHTML = data.name;
					wc_state.innerHTML = data.state;
				}
				setTimeout(function() { wc_command(channel,cmd,result_name,true); }, 5000);
				break;
			case "start":
			case "stop":
				if(data.error) {
					result.innerHTML = data.error;
				}
				else {
					result.innerHTML = "";
					wc_state.innerHTML = data.state;
				}
				break;
		        wc_command(channel,'info','wc_stream_info');
			}
		},
		error:function (req, status, error) {
			result.innerHTML = "Error: " + error;
		}
        });
}

// Initial UI status
updatePublishUI();
updateUI();

</script>
      </div>
      </div>
      </div>


  </body>
</html>

