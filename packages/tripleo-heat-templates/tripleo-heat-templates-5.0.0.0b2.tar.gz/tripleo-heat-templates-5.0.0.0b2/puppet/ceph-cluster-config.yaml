heat_template_version: 2015-04-30
description: 'Ceph Cluster config data for Puppet'

parameters:
  NovaRbdPoolName:
    default: vms
    type: string
  GnocchiRbdPoolName:
    default: metrics
    type: string
  CephClientUserName:
    default: openstack
    type: string

resources:
  CephClusterConfigImpl:
    type: OS::Heat::StructuredConfig
    properties:
      group: os-apply-config
      config:
        hiera:
          datafiles:
            ceph_cluster:
              mapped_data:
                nova::compute::rbd::libvirt_images_rbd_pool: {get_param: NovaRbdPoolName}
                gnocchi::storage::ceph::ceph_pool: {get_param: GnocchiRbdPoolName}
                gnocchi::storage::ceph::ceph_username: {get_param: CephClientUserName}
                nova::compute::rbd::libvirt_rbd_user: {get_param: CephClientUserName}
                nova::compute::rbd::rbd_keyring:
                  list_join:
                  - '.'
                  - - 'client'
                    - {get_param: CephClientUserName}
                gnocchi::storage::ceph::ceph_keyring:
                  list_join:
                  - '.'
                  - - '/etc/ceph/ceph'
                    - 'client'
                    - {get_param: CephClientUserName}
                    - 'keyring'

outputs:
  config_id:
    description: The ID of the CephClusterConfigImpl resource.
    value:
      {get_resource: CephClusterConfigImpl}
