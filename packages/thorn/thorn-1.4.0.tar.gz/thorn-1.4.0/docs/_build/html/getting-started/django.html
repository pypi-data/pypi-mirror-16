<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Django Integration &mdash; Thorn 1.3.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/thorn.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Thorn 1.3.0 documentation" href="../index.html" />
    <link rel="up" title="Getting Started" href="index.html" />
    <link rel="next" title="User Guide" href="../userguide/index.html" />
    <link rel="prev" title="Getting Started" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../userguide/index.html" title="User Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Thorn 1.3.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Getting Started</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="django-integration">
<span id="django-guide"></span><h1>Django Integration<a class="headerlink" href="#django-integration" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents:</p>
<ul class="simple">
<li><a class="reference internal" href="#installation" id="id1">Installation</a></li>
<li><a class="reference internal" href="#django-rest-framework-views" id="id2">Django Rest Framework Views</a></li>
<li><a class="reference internal" href="#example-consumer-endpoint" id="id3">Example consumer endpoint</a></li>
<li><a class="reference internal" href="#verify-hmac-ruby" id="id4">Verify HMAC Ruby</a></li>
<li><a class="reference internal" href="#verify-hmac-php" id="id5">Verify HMAC PHP</a></li>
</ul>
</div>
<div class="section" id="installation">
<span id="django-installation"></span><h2><a class="toc-backref" href="#id1">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To use Thorn with your Django project you must</p>
<ol class="arabic">
<li><p class="first">Install Thorn</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> pip install thorn
</pre></div>
</div>
</li>
<li><p class="first">Add <code class="docutils literal"><span class="pre">thorn.django</span></code> to <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># ...,</span>
    <span class="s1">&#39;thorn.django&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Migrate your database to add the subscriber model:</p>
<blockquote>
<div><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py migrate
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Webhook-ify your models by adding the <code class="docutils literal"><span class="pre">webhook_model</span></code> decorator.</p>
<blockquote>
<div><p>Read all about it in the <a class="reference internal" href="../userguide/events.html#events-guide"><span class="std std-ref">Events Guide</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">(Optional) Install views for managing subscriptions:</p>
<blockquote>
<div><p>Only <a class="reference internal" href="#django-rest-framework"><span class="std std-ref">Django REST Framework</span></a> is supported
yet, please help us by contributing more view types.</p>
</div></blockquote>
</li>
<li><p class="first">Specify the recommended HMAC signing method in your <code class="docutils literal"><span class="pre">settings.py</span></code>:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">THORN_HMAC_SIGNER</span> <span class="o">=</span> <span class="s1">&#39;thorn.utils.hmac:sign&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="django-rest-framework-views">
<span id="django-rest-framework"></span><h2><a class="toc-backref" href="#id2">Django Rest Framework Views</a><a class="headerlink" href="#django-rest-framework-views" title="Permalink to this headline">¶</a></h2>
<p>The library comes with a standard set of views you can add to your
Django Rest Framework API, that enables your users to subscribe and
unsubscribe from events.</p>
<p>The views all map to the <a class="reference internal" href="../reference/thorn.django.models.html#thorn.django.models.Subscriber" title="thorn.django.models.Subscriber"><code class="xref py py-class docutils literal"><span class="pre">Subscriber</span></code></a> model.</p>
<p>To enable them add the following URL configuration to your
<code class="file docutils literal"><span class="pre">urls.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">url</span><span class="p">(</span><span class="s2">r&quot;^hooks/&quot;</span><span class="p">,</span>
    <span class="n">include</span><span class="p">(</span><span class="s2">&quot;thorn.django.rest_framework.urls&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;webhook&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="supported-operations">
<span id="django-rest-framework-operations"></span><h3>Supported operations<a class="headerlink" href="#supported-operations" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All of these curl examples omit the important detail
that you need to be logged in as a user of your API.</p>
</div>
<div class="section" id="subscribing-to-events">
<h4>Subscribing to events<a class="headerlink" href="#subscribing-to-events" title="Permalink to this headline">¶</a></h4>
<p>Adding a new subscription is as simple as posting to the <code class="docutils literal"><span class="pre">/hooks/</span></code> endpoint,
including the mandatory event and url arguments:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ curl -X POST                                                      <span class="se">\</span>
&gt; -H <span class="s2">&quot;Content-Type: application/json&quot;</span>                               <span class="se">\</span>
&gt; -d <span class="s1">&#39;{&quot;event&quot;: &quot;article.*&quot;, &quot;url&quot;: &quot;https://e.com/h/article?u=1&quot;}&#39;</span> <span class="se">\</span>
&gt; http://example.com/hooks/
</pre></div>
</div>
<p>Returns the response:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;c91fe938-55fb-4190-a5ed-bd92f5ea8339&quot;</span><span class="p">,</span>
 <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http:\/\/e.com\/h/article?u=1&quot;</span><span class="p">,</span>
 <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-01-13T23:12:52.205785Z&quot;</span><span class="p">,</span>
 <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-01-13T23:12:52.205813Z&quot;</span><span class="p">,</span>
 <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="nt">&quot;hmac_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;C=JTX)v3~dQCl];[_h[{q{CScm]oglLoe&amp;&gt;ga:&gt;R~jR$.x?t|kW!FH:s@|4bu:11&quot;</span><span class="p">,</span>
 <span class="nt">&quot;hmac_digest&quot;</span><span class="p">:</span> <span class="s2">&quot;sha256&quot;</span><span class="p">,</span>
 <span class="nt">&quot;content_type&quot;</span><span class="p">:</span> <span class="s2">&quot;application\/json&quot;</span><span class="p">,</span>
 <span class="nt">&quot;subscription&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost/hooks/c91fe938-55fb-4190-a5ed-bd92f5ea8339&quot;</span><span class="p">,</span>
 <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;article.*&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p><strong>Parameters</strong></p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">event</span></code> (mandatory)</p>
<blockquote>
<div><p>The type of event you want to receive notifications about.  Events are
composed of dot-separated words, so this argument can also be specified
as a pattern matching words in the event name (e.g. <code class="docutils literal"><span class="pre">article.*</span></code>,
<code class="docutils literal"><span class="pre">*.created</span></code>, or <code class="docutils literal"><span class="pre">article.created</span></code>).</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">url</span></code> (mandatory)</p>
<blockquote>
<div><p>The URL destination where the event will be sent to, using
a HTTP POST request.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">content_type</span></code> (optional)</p>
<blockquote>
<div><p>The content type argument specifies the MIME-type of the format
required by your endpoint.  The default is <code class="docutils literal"><span class="pre">application/json</span></code>,
but you can also specify <code class="docutils literal"><span class="pre">application/x-www-form-urlencoded.</span></code>.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">hmac_digest</span></code> (optional)</p>
<blockquote>
<div><p>Specify custom HMAC digest type, which must be one of: sha1, sha256, sha512.</p>
<p>Default is sha256.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">hmac_secret</span></code> (optional)</p>
<blockquote>
<div><p>Specify custom HMAC secret key.</p>
<p>This key can be used to verify the sender of webhook events received.</p>
<p>A random key of 64 characters in length will be generated by default,
and can be found in the response.</p>
</div></blockquote>
</li>
</ul>
<p>The only important part of the response data at this stage is the <code class="docutils literal"><span class="pre">id</span></code>,
which is the unique identifier for this subscription, and the <code class="docutils literal"><span class="pre">subscription</span></code> url
which you can use to unsubscribe later.</p>
</div>
<div class="section" id="listing-subscriptions">
<span id="django-rest-framework-list-subscriptions"></span><h4>Listing subscriptions<a class="headerlink" href="#listing-subscriptions" title="Permalink to this headline">¶</a></h4>
<p>Perform a <em>GET</em> request on the <code class="docutils literal"><span class="pre">/hooks/</span></code> endpoint to retrieve a list of
all the subscriptions owned by user:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ curl -X GET                                       <span class="se">\</span>
&gt; -H <span class="s2">&quot;Content-Type: application/json&quot;</span>               <span class="se">\</span>
&gt; http://example.com/hooks/
</pre></div>
</div>
<p>Returns the response:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;c91fe938-55fb-4190-a5ed-bd92f5ea8339&quot;</span><span class="p">,</span>
     <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http:\/\/e.com\/h/article?u=1&quot;</span><span class="p">,</span>
     <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-01-15T23:12:52.205785Z&quot;</span><span class="p">,</span>
     <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-01-15T23:12:52.205813Z&quot;</span><span class="p">,</span>
     <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="nt">&quot;content_type&quot;</span><span class="p">:</span> <span class="s2">&quot;application\/json&quot;</span><span class="p">,</span>
     <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;article.*&quot;</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="unsubscribing-from-events">
<span id="django-rest-framework-unsubscribe"></span><h4>Unsubscribing from events<a class="headerlink" href="#unsubscribing-from-events" title="Permalink to this headline">¶</a></h4>
<p>Perform a <em>DELETE</em> request on the <code class="docutils literal"><span class="pre">/hooks/&lt;UUID&gt;</span></code> endpoint to unsubscribe
from a subscription by unique identifier:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ curl -X DELETE                                    <span class="se">\</span>
&gt; -H <span class="s2">&quot;Content-Type: application/json&quot;</span>               <span class="se">\</span>
&gt; http://example.com/hooks/c91fe938-55fb-4190-a5ed-bd92f5ea8339/
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="example-consumer-endpoint">
<span id="django-example-consumer"></span><h2><a class="toc-backref" href="#id3">Example consumer endpoint</a><a class="headerlink" href="#example-consumer-endpoint" title="Permalink to this headline">¶</a></h2>
<p>This is an example Django webhook receiver view, using the json content type:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="kn">from</span> <span class="nn">itsdangerous</span> <span class="kn">import</span> <span class="n">URLSafeSerializer</span>

<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.http</span> <span class="kn">import</span> <span class="n">require_POST</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_exempt</span>

<span class="n">ARTICLE_SECRET</span> <span class="o">=</span> <span class="s1">&#39;C=JTX)v3~dQCl];[_h[{q{CScm]oglLoe&amp;&gt;ga:&gt;R~jR$.x?t|kW!FH:s@|4bu:11&#39;</span>
<span class="n">ARTICLE_DIGEST_TYPE</span> <span class="o">=</span> <span class="s1">&#39;sha256&#39;</span>

<span class="k">def</span> <span class="nf">verify_webhook</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">hmac_header</span><span class="p">,</span> <span class="n">digest_method</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">digestmod</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hashlib</span><span class="p">,</span> <span class="n">digest_method</span><span class="p">)</span>
    <span class="n">signed</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span>
        <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">digestmod</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">(),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">signed</span><span class="p">,</span> <span class="n">hmac_header</span><span class="p">)</span>

<span class="nd">@require_POST</span><span class="p">()</span>
<span class="nd">@csrf_exempt</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">handle_article_changed</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">digest</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_HOOK_HMAC&#39;</span><span class="p">)</span>
    <span class="n">digest_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span>
    <span class="k">if</span> <span class="n">verify_webhook</span><span class="p">(</span><span class="n">ARTICLE_SECRET</span><span class="p">,</span> <span class="n">digest</span><span class="p">,</span> <span class="n">ARTICLE_DIGEST_TYPE</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Article changed: {0[ref]}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the <a class="reference external" href="http://django.readthedocs.io/en/latest/ref/csrf.html#django.views.decorators.csrf.csrf_exempt" title="(in Django v1.11)"><code class="xref py py-func docutils literal"><span class="pre">csrf_exempt()</span></code></a> is important here,
as by default Django will refuse POST requests that do not specify the CSRF
protection token.</p>
</div>
<div class="section" id="verify-hmac-ruby">
<h2><a class="toc-backref" href="#id4">Verify HMAC Ruby</a><a class="headerlink" href="#verify-hmac-ruby" title="Permalink to this headline">¶</a></h2>
<p>This example is derived from Shopify&#8217;s great examples found here:
<a class="reference external" href="https://help.shopify.com/api/tutorials/webhooks#verify-webhook">https://help.shopify.com/api/tutorials/webhooks#verify-webhook</a></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;base64&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;openssl&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>

<span class="no">ARTICLE_SECRET</span> <span class="o">=</span> <span class="s1">&#39;C=JTX)v3~dQCl];[_h[{q{CScm]oglLoe&amp;&gt;ga:&gt;R~jR$.x?t|kW!FH:s@|4bu:11&#39;</span>

<span class="n">helpers</span> <span class="k">do</span>

    <span class="k">def</span> <span class="nf">verify_webhook</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">hmac_header</span><span class="p">):</span>
        <span class="n">digest</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="o">::</span><span class="no">Digest</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">)</span>
        <span class="n">calculated_hmac</span> <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="ss">OpenSSL</span><span class="p">:</span><span class="no">HMAC</span><span class="o">.</span><span class="n">digest</span><span class="p">(</span>
            <span class="n">digest</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span>
        <span class="k">return</span> <span class="n">calculated_hmac</span> <span class="o">==</span> <span class="n">hmac_header</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
    <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">rewind</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">read</span>
    <span class="k">if</span> <span class="n">verify_webhook</span><span class="p">(</span><span class="no">ARTICLE_SECRET</span><span class="p">,</span> <span class="n">env</span><span class="o">[</span><span class="s2">&quot;HTTP_HOOK_HMAC&quot;</span><span class="o">]</span><span class="p">)</span>
        <span class="c1"># deserialize data&#39; using json and process webhook</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="verify-hmac-php">
<h2><a class="toc-backref" href="#id5">Verify HMAC PHP</a><a class="headerlink" href="#verify-hmac-php" title="Permalink to this headline">¶</a></h2>
<p>This example is derived from Shopify&#8217;s great examples found here:
<a class="reference external" href="https://help.shopify.com/api/tutorials/webhooks#verify-webhook">https://help.shopify.com/api/tutorials/webhooks#verify-webhook</a></p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ARTICLE_SECRET&#39;</span><span class="p">,</span> <span class="s1">&#39;C=JTX)v3~dQCl];[_h[{q{CScm]oglLoe&amp;&gt;ga:&gt;R~jR$.x?t|kW!FH:s@|4bu:11&#39;</span><span class="p">)</span>

<span class="k">function</span> <span class="nf">verify_webhook</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$hmac_header</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$calculated_hmac</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">hash_hmac</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span>
        <span class="nx">ARTICLE_SECRET</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
    <span class="k">return</span> <span class="p">(</span><span class="nv">$hmac_header</span> <span class="o">==</span> <span class="nv">$calculated_hmac</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$hmac_header</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_HOOK_HMAC&#39;</span><span class="p">];</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;php://input&#39;</span><span class="p">);</span>
<span class="nv">$verified</span> <span class="o">=</span> <span class="nx">verify_webhook</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$hmac_header</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p><script async defer src="https://buttons.github.io/buttons.js"></script>
<a class="github-button" href="https://github.com/robinhood/thorn" data-icon="octicon-star" data-style="mega" data-count-href="/robinhood/thorn/stargazers" data-count-api="/repos/robinhood/thorn#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star Thorn on GitHub">Star</a>
<a class="github-button" href="https://github.com/robinhood/thorn/issues" data-icon="octicon-issue-opened" data-style="mega" data-count-api="/repos/robinhood/thorn#open_issues_count" data-count-aria-label="# issues on GitHub" aria-label="Issue robinhood/thorn on GitHub">Issue</a>
  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Getting Started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../userguide/index.html"
                        title="next chapter">User Guide</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/getting-started/django.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../userguide/index.html" title="User Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Getting Started"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Thorn 1.3.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Getting Started</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; <a href="../copyright.html">Copyright</a> 2016, Robinhood Markets.
    </div>
  </body>
</html>