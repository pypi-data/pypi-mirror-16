$(document).ready(function(){function Q(){if(E.domain()[0]<0){var a=G.translate()[0]-E(0)+E.range()[0];G.translate([a,0])}else if(E.domain()[1]>p){var a=G.translate()[0]-E(p)+E.range()[1];G.translate([a,0])}d3.selectAll("g.x.axis").call(H);var b=d3.event.translate[0],c=d3.event.scale;b=Math.min(0,Math.max(k*(1-c),b)),d3.selectAll("path.area").attr("transform","translate("+b+",0)scale("+c+", 1)"),d3.selectAll(".popLabels").attr("transform",function(a){var b=E(a)+v,c=u,d=t;return"translate("+b+","+c+")rotate("+d+")"}).style("fill",function(a){return E(a)+v<0||E(a)+v>k?"none":"black"})}function ea(a,b,c){var d=$("#slider_main");return b&&"no"!=a?d=$("#slider_"+a):"no"!=a&&(d=$("#slider_"+a+"_download")),"png"==c&&b?.5*d.slider("option","value"):d.slider("option","value")}function fa(a,b){var c=document.createElement("a");c.href=a.src,c.type="hidden",c.download=b,document.body.appendChild(c),c.click(),document.body.removeChild(c)}function ga(a,b){var c=document.createElement("a");c.href=a.toDataURL("image/png"),c.type="hidden",c.download=b,document.body.appendChild(c),c.click(),document.body.removeChild(c)}function ha(a,b,e,f,g){da=ea(f,!1,g);var h=d3.select("#plot"+f).node(),i=d3.select(".majorPopLabels").node(),j=[i.getBoundingClientRect().width+5,i.getBoundingClientRect().height],k=new Date,l=k.getFullYear()+"-"+k.getMonth()+"-"+k.getDate()+"_"+k.getHours()+"h"+k.getMinutes()+"m"+k.getSeconds()+"s",m="K="+d3.select("#plot"+f).attr("class").split(" ")[1]+"_majormode_"+l+"_pong";if(b){var n=h.getAttribute("class").split(" "),o=n[0].slice(h.getAttribute("class").indexOf("-")+1);m=n.length<2?f.substr(0,f.indexOf("_"))+"_K="+o+"_minormode_"+l+"_pong":f.substr(0,f.indexOf("_"))+"_K="+o+"_majormode_"+l+"_pong",i=d3.select(".minorPopLabels_"+o).node(),d3.select(".minorPopLabels_"+o).attr("height",j[1]).attr("width",j[0])}var p=h.getBoundingClientRect(),q=document.createElement("canvas");if(q.width=Math.max(j[0],p.width/G.scale())*da+20,q.height=(j[1]+p.height)*da+20,"print"==g){var r=window.open();r.document.title="pong download"}if("svg"==g){var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width",Math.max(j[0],p.width/G.scale())),s.setAttribute("height",j[1]+p.height),s.appendChild(h.cloneNode(!0));var t=i.cloneNode(!0);t.setAttribute("y",p.height),s.appendChild(t),ja(s,null,0,function(a){fa(a,m+".svg"),b&&d3.select(".minorPopLabels_"+o).attr("height",d).attr("width",c)})}else ja(h,q,0,function(a){ja(i,q,p.height*da,function(e){"print"==g?(r.document.body.appendChild(a),r.document.body.appendChild(e),r.print()):ga(q,m+".png"),b&&d3.select(".minorPopLabels_"+o).attr("height",d).attr("width",c)})})}function ia(a,b){da=ea(a,!0,b);var e=d3.select(".majorPopLabels").node(),f=[e.getBoundingClientRect().width,e.getBoundingClientRect().height],g=new Date,h=g.getFullYear()+"-"+g.getMonth()+"-"+g.getDate()+"_"+g.getHours()+"h"+g.getMinutes()+"m"+g.getSeconds()+"s",i="mainviz_"+h+"_pong",j=document.getElementsByClassName("majorSVG");"no"!=a&&(j=document.getElementsByClassName("minorSVG-"+a),i="modes_K="+a+"_"+h+"_pong",e=d3.select(".minorPopLabels_"+a).node(),d3.select(".minorPopLabels_"+a).attr("height",f[1]).attr("width",f[0]));var k=d3.select(j[0]).node().getBBox(),l=document.createElement("canvas");if(l.width=Math.max(f[0],k.width/G.scale())*da,l.height=(f[1]+(k.height+20)*j.length)*da,"print"==b){var m=window.open();m.document.title="pong download"}var n=0,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width",Math.max(f[0],k.width/G.scale())),o.setAttribute("height",f[1]+(k.height+20)*j.length);for(var p=0;p<j.length;p++){var q=d3.select(j[p]);if("svg"==b){var r=d3.select(j[p]).node().cloneNode(!0);if(r.setAttribute("y",(k.height+20)*p),o.appendChild(r),n+=1,n==j.length){var s=e.cloneNode(!0);s.setAttribute("y",(k.height+20)*j.length),o.appendChild(s),ja(o,null,0,function(b){fa(b,i+".svg"),"no"!=a&&d3.select(".minorPopLabels_"+a).attr("height",d).attr("width",c)})}}else ja(q.node(),l,(k.height+20)*p*da,function(f){"print"==b&&m.document.body.appendChild(f),n+=1,n==j.length&&ja(e,l,(k.height+20)*j.length*da,function(e){"print"==b?(m.document.body.appendChild(e),m.print()):"png"==b&&ga(l,i+".png"),"no"!=a&&d3.select(".minorPopLabels_"+a).attr("height",d).attr("width",c)})})}}function ja(a,b,c,d){var e=(new XMLSerializer).serializeToString(a),f=new Image;if(f.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e))),b){var g=b.getContext("2d");f.onload=function(){g.drawImage(f,0,0,f.width,f.height,0,c,f.width*da,f.height*da),d&&(d(f),f.onload=null)}}else d(f)}function ka(a,b){var c=/[^0-9]/g,d=parseInt(a.replace(c,""),10),e=parseInt(b.replace(c,""),10);return d===e?0:d>e?1:-1}$(window).on("beforeunload",function(){$(window).scrollTop(0)}),$("#loading").fadeIn();var e,f,g,h,j,k,m,n,o,p,g,H,a=window.innerWidth,c=(window.innerHeight,.9*a),d=160,q="black",r=.8*d,s=20,t=45,u=10,v=5,w=!1,x=!1,y=!1,z=d3.stack(),A=d3.area().x(function(a,b){return E(a.data.index)}).y0(function(a){return F(a[0])}).y1(function(a){return F(a[1])}).curve(d3.curveStepAfter),B=["#E04B4B","#6094C3","#63BC6A","#A76BB2","#F0934E","#FEFB54","#B37855","#EF91CA","#A4A4A4"],C=["#f0a3ff","#0075dc","#993f00","#4c005c","#191919","#005c31","#2bce48","#ffcc99","#808080","#94ffb5","#8f7c00","#9dcc00","#c20088","#003380","#ffa405","#ffa8bb","#426600","#ff0010","#5ef1f2","#00998f","#e0ff66","#740aff","#990000","#ffff80","#ffff00","#ff5005"],D=0,E=d3.scale.linear(),F=d3.scale.linear(),G=d3.behavior.zoom().on("zoom",Q),J=(new Array,$(window).width());$(window).resize(function(){$(this).width()!=J&&(J=$(this).width(),this.resizeTO&&clearTimeout(this.resizeTO),this.resizeTO=setTimeout(function(){$("#resize-warning-nav").show()},500))}),$("#resize-warning-exit").click(function(){$("#resize-warning-nav").hide()});var K="ws://"+location.host+"/pongsocket",L=new WebSocket(K),M=0,N=0;L.onmessage=function(a){var b=JSON.parse(a.data);if("pong-data"==b.type){g=b.pong;for(var f in g.qmatrices)modes=Object.keys(g.qmatrices[f].modes).length,N+=1==modes?1:modes+1;for($("#loading").fadeIn(),D+=g.qmatrices.length,h=g.popNames,j=g.popSizes,g.colors.length>0?B=g.colors:g.K_max>9&&(B=C),e=new Array,f=0;f<g.qmatrices.length;f++){var i=g.qmatrices[f].major_mode_runid;plot=d3.select("#visualization").append("svg").attr("width",c).attr("height",d+15).attr("class","majorSVG "+g.qmatrices[f].K).attr("id","plot"+i),e.push(plot),O(i,"no",null,null)}}else if("q-matrix"==b.type){M+=1,d3.select("#progress-bar").transition().attr("width",280*M/N);var k;k="yes"==b.minor;var l=b.minorID,m=b.is_first;k?P(d3.select("#plot"+b.name+"_minor"),b.K,b.matrix2d,k,l,m,b.name):P(d3.select("#plot"+b.name),b.K,b.matrix2d,k,l,m,b.name)}};var O=function(a,b,c,d){L.send(JSON.stringify({type:"get-qmatrix",name:a,minor:b,minorID:c,is_first:d}))},P=function(a,b,e,f,h,j,l){var s=r,t=g.qmatrices[b-g.K_min].color_perm;k=.84*c,n=.08*c,o=0;var u=g.qmatrices[b-g.K_min],v=u.major_mode_runid,x=Object.keys(u.modes),C=x.indexOf(v);C>-1&&x.splice(C,1);var I=X(u,x);0==x.length||f||(D+=x.length+1,T(b,I)),f?W(a,u,h,j):(V(a,b,u),Z(a,b,v));var J=15,K=5;a.append("rect").attr("class","background").attr("x",n-K/2).attr("y",J-K/2).attr("height",s+K).attr("width",k+K).attr("fill",q);var L=a.append("g").attr("transform","translate("+n+", "+J+")").attr("class","chart").attr("clip-path","url(#clip)");L.append("clipPath").attr("id","clip").append("rect").attr("width",k).attr("height",s+50),p=1+e.slice(-1)[0].members.slice(-1)[0].index,E.range([0,k]).domain([0,p]),F.range([s,0]).domain([0,1]),tickVals=[],e.forEach(function(a){tickVals.push(a.members[0].index)});var M=Object.keys(e[0].members[0]).filter(function(a){return"index"!=a}).sort(ka);z.keys(M);var N=L.selectAll(".pops").data(e).enter().append("g").attr("class",function(a){return"pops population"+a.population_index}),O=N.selectAll(".layer").data(function(a){for(var c=z(a.members),d=0;d<c.length;d++)c[d].population_index=a.population_index,c[d].K=b,c[d].indiv_avg=g.indiv_avg[l][a.population_index];return c}).enter().append("g").attr("class","layer");O.append("path").attr("class",function(a,b){var c="area ";return f&&(c+=h+"_minorCluster"+t[b]+" "),c+="K"+a.K+" population"+a.population_index+" cluster"+t[b]}).style("fill",function(a,b){return B[t[b]]}).attr("d",function(a,b){var c=[0,0];return c.data={index:a[a.length-1].data.index+1},a[a.length]=c,A(a)}).on("click",function(a){y||(d3.selectAll("path.area").style("fill",function(b){var c=g.qmatrices[b.K-g.K_min].color_perm;return w?B[c[parseInt(b.key.slice(7))-1]]:c[parseInt(b.key.slice(7))-1]!=t[parseInt(a.key.slice(7))-1]?"white":B[c[parseInt(b.key.slice(7))-1]]}),w?d3.selectAll(".check-input").attr("disabled",null):d3.selectAll(".check-input").attr("disabled","disabled"),w=!w)});var P=d3.selectAll("path.area");if(P.call(G).call(_).on("mouseover",_.show).on("mouseout",_.hide).on("dblclick.zoom",null),H=d3.svg.axis().scale(E).orient("bottom").tickValues(tickVals).tickFormat("").tickSize(-s),L.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").style("fill","none").style("stroke",q).call(H),G.x(E).scaleExtent([1,20]),d3.select("#whiteout"+b).on("click",function(){for(i in I)Y(b,I[i],t,m);y=!y}),b!=g.K_max||f){if(h&&h==I.slice(-1)[0]){var Q=d3.select("#modal_body_"+b).append("svg").attr("class","minorPopLabels_"+b).attr("height",d).attr("width",c),S=Q.append("g").attr("class","labelSVGminor_"+b).attr("transform","translate("+(n-K/2)+",0)");R(S,!0,b,tickVals);aa(b)}}else{var Q=d3.select("#visualization").append("svg").attr("class","majorPopLabels").attr("width",c+80),S=Q.append("g").attr("class","labelSVG").attr("transform","translate("+(n-K/2)+",0)");R(S,!1,b,tickVals);Q.attr("height",S.node().getBBox().height+80)}if(ca(a,b,u,f,g.K_min,"print"),ca(a,b,u,f,g.K_min,"download"),!f)var ba=u.major_mode_runid;if(f)var ba=a[0][0].getAttribute("id").slice(4);$("#"+ba+"_print").click(function(b){b.preventDefault(),ha(u,f,a,ba,"print")}),$("#"+ba+"_download_png").click(function(b){b.preventDefault(),ha(u,f,a,ba,"png")}),$("#"+ba+"_download_svg").click(function(b){b.preventDefault(),ha(u,f,a,ba,"svg")}),$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip()}),D--,0===D&&$("#loading").delay(200).fadeOut()},R=function(a,b,c,d){b?popid="minor_"+c+"_pop"+i:popid="major_pop"+i;var e=a.selectAll(".popLabels").data(d).enter().append("text").style("font-family","Helvetica").text(function(a,b){return h[b]}).attr("transform",function(a){var b=E(a)+v,c=u,d=t;return"translate("+b+","+c+")rotate("+d+")"}).attr("class","popLabels noSelect").attr("id",function(a,b){return"major_pop"+b}).on("click",function(a,b){if(d3.event.shiftKey&&x){var c=d3.selectAll("path.area.population"+b);1==c.attr("fill-opacity")?c.attr("fill-opacity",.2):c.attr("fill-opacity",1)}else d3.selectAll("path.area").attr("fill-opacity",function(a){g.qmatrices[a.K-g.K_min].color_perm;return x?1:a.population_index!=b?.2:1}),x=!x});return e},T=function(a,b){var e=d3.select("body").append("div").attr("class","buttonDiv"),f=e.append("button").attr("class","modes btn btn-info btn-lg").attr("data-toggle","modal").attr("data-target","#modal-"+a).attr("id","button-"+a);f.style("position","absolute").style("top",129+(d+20)*(a-g.K_min)+98+"px").style("left",n+.84*c+20+"px"),f.html('<i class="fa fa-plus"></i> <span style="font-weight:bold; font-size:125%;">'+b.length+"</span>"),U(a,b,f,e)},U=function(a,b,e,h){var j=h.append("div").attr("class","modal fade").attr("id","modal-"+a).attr("role","dialog"),k=j.append("div").attr("class","modal-dialog"),l=k.append("div").attr("class","modal-content").attr("id","modal-content-"+a).style("width",c+45+"px").style("left",o+10+"px"),n=l.append("div").attr("class","modal-header").attr("id","title"+a);n.append("button").attr("type","button").attr("class","close").attr("data-dismiss","modal").html("<span>&times;</span>"),n.append("h2").attr("class","modal-title").html("Clustering modes, K="+a);f=new Array;var r=g.qmatrices[a-g.K_min].color_perm;$("#modal-"+a).on("hide.bs.modal",function(c){if(y){for(i in b)Y(a,b[i],r,m);y=!1,$("#whiteout"+a).attr("checked",!1)}});var s=l.append("div").attr("class","modal-header").attr("id","modal_header2_"+a);for(dirtyGray=0,i=0;i<b.length;i++){var t=b[i];if(minor_obj=g.qmatrices[a-g.K_min].modes[t],0!=minor_obj.gray_indices.length){dirtyGray=1;break}}if(dirtyGray){var u=s.append("label").attr("class","checkbox-inline");u.append("input").attr("type","checkbox").attr("class","check-input").attr("id","whiteout"+a),u.style("position","relative").style("top","4px");s.append("label").attr("class","checkbox-caption noSelect").attr("for","whiteout"+a).text("\nCheck to highlight multimodality: ")}else 1==b.length?mymodestr="minor mode":mymodestr="minor modes",s.append("button").attr("type","submit").attr("class","btn btn-danger btn-small pull-right").attr("id","highlightMM_"+a).attr("data-toggle","tooltip").attr("data-placement","left").attr("title","Similarity between corresponding clusters in the major mode and "+mymodestr+" is less than the similarity threshold of "+g.sim_threshold+". Lower the similarity threshold in pong's command line to enable highlighting.").text("Why can't I highlight multimodality?");var w=g.qmatrices[a-g.K_min].major_mode_runid;plot=d3.select("#modal_header2_"+a).append("svg").attr("width",c).attr("height",d+15).attr("class","minorSVG-"+a+" first").attr("id","plot"+w+"_minor"),f.push(plot),O(w,"yes",w,"yes");l.append("div").attr("class","modal-body").attr("id","modal_body_"+a);for(i=0;i<b.length;i++){var t=b[i];plot=d3.select("#modal_body_"+a).append("svg").attr("width",c).attr("height",d+15).attr("class","minorSVG-"+a).attr("id","plot"+t+"_minor"),f.push(plot),O(t,"yes",t,"no")}},V=function(a,b,c){var d=c.total_runs,e=c.major_mode_runid,f=c.modes[e].runs_represented.length,g=.5*r+.5*s;label=a.append("text").text("K = "+b),label.attr("class","label").style("font","bold 20px Helvetica, sans-serif"),label.attr("x",0).attr("y",g),runs=a.append("text").text(f+"/"+d+" runs").attr("id","major_bigstring"),runs.attr("x",0).attr("y",g+25),runs.style("font","12px Helvetica, sans-serif");var h=document.getElementById("major_bigstring").getBBox(),i=h.width;i>n&&(n=i+5),avg_sim=c.modes[e].avg_sim,null!=avg_sim&&(sim=a.append("text").text("Avg. pairwise similarity: "+avg_sim.toString().substring(0,5)),sim.attr("x",n).attr("y",9),sim.style("fill","rgb(70, 184, 218)"),sim.style("font","bold 11px Helvetica, sans-serif"))},W=function(a,b,c,d){var e=b.total_runs,f=b.modes[c].runs_represented.length,g=.5*r*.85+.5*s;return"yes"==d&&(major=a.append("text").text("major mode"),major.attr("class","majorMinorLabel").attr("id","minor_bigstring"),major.attr("x",0).attr("y",g-38-15),major.style("font","bold 14px Helvetica, sans-serif")),83.609>n&&(n=88.609),label=a.append("text").text(c),label.attr("class","label"),label.attr("x",0).attr("y",g-26),label.style("font","20px Helvetica, sans-serif"),rep=a.append("text").text("represents"),rep.attr("x",0).attr("y",g+14-26),rep.style("font","12px Helvetica, sans-serif"),runs=a.append("text").text(f+"/"+e+" runs"),runs.attr("class","minorRun"),runs.attr("x",0).attr("y",g+30-26),runs.style("font","12px Helvetica, sans-serif"),avg_sim=b.modes[c].avg_sim,null!=avg_sim&&(sim=a.append("text").text("Avg pairwise similarity:"+avg_sim.toString().substring(0,5)),sim.attr("class","avg_sim"),sim.attr("x",n).attr("y",10),sim.style("fill","rgb(70, 184, 218)"),sim.style("font","bold 12px Helvetica, sans-serif")),0},X=function(a,b){var c={};for(var d in b){var e=b[d],f=a.modes[e].runs_represented.length;c[e]=f}var g=Object.keys(c).map(function(a){return[a,c[a]]});g.sort(function(a,b){return b[1]-a[1]});var h=new Array;for(var d in g)h.push(g[d][0]);return h},Y=function(a,b,c,d){var e=g.qmatrices[a-g.K_min].modes[b];if(null!=e.gray_indices){var f=e.gray_indices;for(i in e.gray_indices){var h=c[f[i]],j="."+b+"_minorCluster"+h,k=d3.select("#modal_body_"+a).select(".printModal"),l=d3.select("#modal_body_"+a).select(".modalDropdown a div");"rgb(255, 255, 255)"!=d3.selectAll(j).style("fill")?(d3.selectAll(j).style("fill","white"),k.classed("btn btn-primary",!0).text("Print highlighting multimodality at K="+a),l.classed("btn btn-primary",!0).text("Download highlighting multimodality at K="+a)):(d3.selectAll(j).style("fill",B[c[f[i]]]),k.classed("btn-primary",!1).text("Print all modes at K="+a),l.classed("btn-primary",!1).text("Download all modes at K="+a))}}},Z=function(a,b){var c=g.qmatrices[b-g.K_min].avg_sim_bt_modes,d=Math.round(1e3*c)/1e3;null!=d&&(simMode=d3.select("#title"+b).append("h4").text("\nAvg pairwise similarity among modes = "+d))},_=d3.tip().direction("s").attr("class","d3-tip").offset([10,0]).html(function(a){var b=a.K,c=g.qmatrices[b-g.K_min].color_perm,d='<div class="text-center text-tip"><strong>'+h[a.population_index]+"</strong><br>"+j[a.population_index]+" samples</div><br>";d+="<div><ul>";for(var e=[],f=0;f<b;f++)e.push({datum:a.indiv_avg[f],color:B[c[f]]});return e.sort(function(a,b){return a.datum>b.datum?-1:a.datum==b.datum?0:1}),e.forEach(function(a,b){var c=Math.round(1e3*a.datum)/10,e=a.color;c>=.5&&(d+='<i class="fa fa-circle" style="color: '+e+' "></i>',d+="&nbsp;<strong> "+c+"%</strong></li><br>")}),d+="</ul></div>"});$(document).on("click","#printAllPlots",function(){ia("no","print")}),$(document).on("click",".printModal",function(){var a=$(this)[0].id;ia(a,"print")}),$(document).on("click","#main_png",function(){ia("no","png")}),$(document).on("click","#main_svg",function(){ia("no","svg")}),$(document).on("click",".downloadModalPNG",function(){var a=$(this)[0].id;ia(a,"png")}),$(document).on("click",".downloadModalSVG",function(){var a=$(this)[0].id;ia(a,"svg")});var aa=function(a){var c=d3.select("#modal_body_"+a).append("div").attr("class","modal-body").append("div").attr("class","row").append("div").attr("class","text-center"),e=(c.append("button").attr("type","submit").attr("class","btn btn-default printModal").attr("id",a).text("Print all modes at K="+a),c.append("div").attr("class","dropdown dropdown-toggle modalDropdown")),f=e.append("a").attr("class","dropdown").attr("data-toggle","dropdown").attr("aria-expanded","false").append("div").attr("class","btn btn-default").text("Download all modes at K="+a);ba(e,a,f,!0)},ba=function(a,b,c,d){var e=a.append("ul").attr("class","dropdown-menu download-menu").attr("id",b+"_dropdown"),f=e.append("div").attr("class","slider").style("margin","10px").style("margin-left","15px").style("margin-right","15px").style("font-size","12px").attr("id","slider_div_"+b);f.append("div").attr("class","img_slider").text("Image size"),f.append("div").attr("id","slider_"+b),f.on("click",function(){d3.event.stopPropagation(),d3.event.preventDefault()});var g=f.append("div").attr("class","slider_axis").style("display","flex").style("justify-content","space-between").style("width","100%").style("font-size","9px");g.append("div").text("Smaller"),g.append("div").text("Larger");var h=e.append("li").append("a").attr("data-format","png").attr("title","Download plot as PNG").text("PNG"),i=e.append("li").append("a").attr("data-format","svg").attr("title","Download plot as SVG").text("SVG");d?(h.attr("class","downloadModalPNG").attr("id",b),i.attr("class","downloadModalSVG").attr("id",b)):(h.attr("id",b+"_png"),i.attr("id",b+"_svg")),Modernizr.adownload||(c.attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Download not fully supported in this browser. Please save the following page after selecting a file type to download locally."),i.append("tspan").text(" (Save with format 'Page Source')").style("font-size","10px")),$("#slider_"+b).slider({value:2,min:1,max:3,step:.5})},ca=function(a,b,c,e,f,g){if(!e)var h=d3.select("body").append("div").attr("class","pbDiv"),i=c.major_mode_runid+"_"+g;if(e)var h=d3.select("#modal_body_"+b).append("div").attr("class","pbDiv"),i=a[0][0].getAttribute("id").slice(4)+"_"+g,j=a[0][0].getAttribute("id").slice(4).slice(0,a[0][0].getAttribute("id").slice(4).indexOf("_minor")),k=Object.keys(c.modes),l=X(c,k),m=l.indexOf(j);if("print"==g)var n=h.append("a").attr("id",i).append("span").attr("class","glyphicon glyphicon-print");else if("download"==g){var n=h.attr("class","dropdown").append("a").attr("id",i).attr("data-toggle","dropdown").attr("class","dropdown-toggle").attr("aria-expanded","false").attr("aria-hadpopup","true").append("span").attr("class","glyphicon glyphicon-download-alt");ba(h,i,n,!1)}var o="40px";if("download"==g)var o="62px";e||("download"!=g&&n.attr("title",g+" K="+b+" barplot"),n.attr("id",g+"-major-"+b),h.style("position","absolute").style("top",1.125*d*(b-f+1)+90+"px").style("left",o)),e&&("download"!=g&&n.attr("title",g+" "+j+" barplot"),n.attr("id",g+"-minor-"+j),h.style("position","absolute").style("left",o),0==m?h.style("top",.5*d*-1+"px"):h.style("top",1.125*d*(m-1)+130+"px"))},da=2;ba(d3.select("#downloadAllDiv"),"main",d3.select("#downloadAllDropdownLink"),!1)});