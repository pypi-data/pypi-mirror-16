{% extends "iptables/__base.html" %}
{% load i18n %}

{% block headtitle %}{% trans 'Edit Node &middot; Silent Dune' noop %}{% endblock %}

{% block page-content %}

  <ol class="breadcrumb">
    <li><a href="/dashboard/">Dashboard</a></li>
    <li><a href="/node/nodes/">Nodes</a></li>
    <li>Node</li>
  </ol>


  <h3 class="page-header"> Node</h3>

  <span style="float: right; margin-top: -52px; font-size: large;" class="glyphicon glyphicon-question-sign"></span>

  <form role="form" action="#" method="POST" >{% csrf_token %}
    <div class="row">
      <div class="col-sm-1 col-md-1 col-lg-1"></div>
      <div class="col-sm-10 col-md-10 col-lg-10">
        <div class="panel panel-primary">
          <div class="panel-heading">Node Information </div>
            <div class="panel-body">
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style="float: left;margin-top: 10px;">
                <label for="name">Lockdown State:</label><br>
                 <span class="label label-{% if node.locked %}danger{% else %}success{% endif %}" style="font-size: 22px; float: left; " >
                   {% if node.locked %} Locked! {% else %} Unlocked {% endif %}
                 </span> 
              </div>
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style="float: left; margin-top: 10px; background: none;">
                <label for="name">&nbsp;</label><br>
                <input class="btn btn-warning" type="button" value="Toggle Lockdown State" id="toggle_locked"  >
              </div>
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style="float: left;margin-top: 10px; background: none;">
                <label for="name">Active State:</label><br>
                <span class="label label-{% if node.active %}success{% else %}danger{% endif %}" style="font-size: 22px; float: left; " >
                  {% if node.active %}Active{% else %}Not Active{% endif %}</span>
              </div>
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px; background: none' >
                <label for="name">&nbsp; </label>
                <div style="height: 34px;  ">&nbsp;</div>
              </div>              
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">Last Connection</label>
                <input class="form-control" id=" " type="text" value="{{ node.last_connection }}" disabled>
              </div>
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">Estimated Next Connection</label>
                <input class="form-control" id=" " type="text" value="{{ next_time }}" disabled>
              </div>              
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='float: left; margin-top: 20px; background: none'>
                <label for="name">System Description</label>
                <input class="form-control" id=" "  name="system"  type="text" value="{{ node.system }}" {% if view %} disabled {% endif %}>
              </div>
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 20px; background: none' >
                <label for="name">&nbsp; </label>
                <div style="height: 34px;  ">&nbsp;</div>
              </div>              
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style="float: left;margin-top: 10px; background: none;">
                <label for="name">Bundle Select:</label><br>
                  <div class="input-group input-group-sm" style=" float: left;">
                    <span class="input-group-addon">Bundle</span>
                    <input type="text" class="form-control" aria-label="..." value="{{ current_bundle.name }}" id="bundle" name="bundle"
                           style="background: white;" {% if view %} disabled {% endif %}>
                    <div class="input-group-btn">
                      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                              aria-haspopup="true" aria-expanded="false"><span class="caret"></span></button>
                      {% if not view %}        
                      <ul class="dropdown-menu dropdown-menu-right"  id="bundle-dd">
                        {% for bundle in bundles %}
                        <li><a href="#">{{ bundle.name }}</a></li>
                        {% endfor %}
                      </ul>
                      {% endif %}
                    </div>
                    <!-- /btn-group -->
                  </div>
              </div>
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px; background: none' >
                <label for="name">&nbsp; </label>
                <div style="height: 34px;  ">&nbsp;</div>
              </div>               
              <div class="col-xs-12 col-sm-12 col-md-12 col-lg-10" style='margin-top: 10px;'>
                <label for="notes">Notes</label>
                <textarea class="form-control" id="notes" name="notes" rows="2" style="resize: vertical;" {% if view %} disabled {% endif %} >{{ node.notes }}</textarea>
              </div>                                          
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">Platform</label>
                <input class="form-control" id=" " type="text" value="{{ node.platform }}" disabled>
              </div>
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">OS</label>
                <input class="form-control" id=" " type="text" value="{{ node.os }}" disabled>
              </div>   
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">Distribution</label>
                <input class="form-control" id=" " type="text" value="{{ node.dist }}" disabled>
              </div> 
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">Distribution Verion</label>
                <input class="form-control" id=" " type="text" value="{{ node.dist_version }}" disabled>
              </div> 
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">HostName</label>
                <input class="form-control" id=" " type="text" value="{{ node.hostname }}" disabled>
              </div> 
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">Python Version</label>
                <input class="form-control" id=" " type="text" value="{{ node.python_version }}" disabled>
              </div> 
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">Machine ID</label>
                <input class="form-control" id=" " type="text" value="{{ node.machine_id }}" disabled>
              </div>  
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">Sync</label>
                <input class="form-control" id=" " type="text" value="{{ node.sync }}" disabled>
              </div>
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">Push</label>
                <input class="form-control" id=" " type="text" value="{{ node.push }}" disabled>
              </div>
              <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6" style='margin-top: 10px;'>
                <label for="name">Polling Interval (secs)</label>
                <input class="form-control" id=" " type="text" value="{{ node.polling_interval }}" disabled>
              </div>
          </div>
        </div>
                <!-- from here -->
        <input type="hidden" name="bundle_id" value="{{ bundle.id }}" >     
        {% if can_edit %}
        <input class="btn btn-primary" type="submit" value="Save">
        {% endif %}
    </div>
  </form>

{% endblock page-content %}



{% block script %}

<script>
  
  $("#toggle_locked").click(function event(){
    var node_id = "{{ node.id }}"
 
    $.ajax({
        type: "POST",
        url: "/node/node/toggle_locked/",
        crossDomain: true,
        data: { csrfmiddlewaretoken: "{{ csrf_token }}",   // < here 
                node_id: node_id,
              },
        dataType: "text",      
    })   
    
    .done(function(data){
      location.reload();  //update the page with new status data from the server
    })
    
    .fail(function(jqXHR, status, error){
      //alert("node: {{node.name}} toggle has failed.");
    })    
    
  }); 
  
    // bundle drop down
  $("#bundle-dd li a").click(function(){
    $("#bundle").val($(this).text());
  }); 
 
  
</script>  

{% endblock script %}
