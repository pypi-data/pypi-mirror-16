{% extends "dashboard/__base.html" %}
{% load i18n %}

{% block headtitle %}{% trans 'Overview &middot; Silent Dune' noop %}{% endblock %}

{% block page-content %}

  <ol class="breadcrumb">
    <li>Dashboard</li>
  </ol>

  <h1 class="page-header">Overview</h1>

  <div class="row">
    <div class="col-lg-3 col-md-6">
        <div class="panel panel-red">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="glyphicon glyphicon-flash fa-5x"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div class="huge">{{alert_count}}</div>
                        <div>Alerts!</div>
                    </div>
                </div>
            </div>
            <a href="/alert/alerts/">
                <div class="panel-footer">
                    <span class="pull-left">View Details</span>
                    <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                    <div class="clearfix"></div>
                </div>
            </a>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="panel panel-green">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="glyphicon glyphicon-briefcase fa-5x"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div class="huge">{{bundle_count}}</div>
                        <div>Chain Bundles</div>
                    </div>
                </div>
            </div>
            <a href="/rules/bundles/">
                <div class="panel-footer">
                    <span class="pull-left">View Details</span>
                    <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                    <div class="clearfix"></div>
                </div>
            </a>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="panel panel-yellow">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="glyphicon glyphicon-link fa-5x"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div class="huge">{{ chain_count }}</div>
                        <div>Rule Chains</div>
                    </div>
                </div>
            </div>
            <a href="/rules/machine_subsets/">
                <div class="panel-footer">
                    <span class="pull-left">View Details</span>
                    <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                    <div class="clearfix"></div>
                </div>
            </a>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="glyphicon glyphicon-tag fa-5x"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div class="huge">{{ node_count }}</div>
                        <div>System Nodes</div>
                    </div>
                </div>
            </div>
            <a href="/node/nodes/">
                <div class="panel-footer">
                    <span class="pull-left">View Details</span>
                    <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                    <div class="clearfix"></div>
                </div>
            </a>
        </div>
    </div>
  </div>

  <h1 class="page-header">Details</h1>

  <div class="row">
    <div class="col-lg-6">
      <div class="panel panel-default">
          <div class="panel-heading">
              <i class="fa fa-bell fa-fw"></i> Notifications Panel
          </div>
          <!-- /.panel-heading -->
          <div class="panel-body">
              <div class="table-responsive">
                  <table class="table table-hover">
                      <thead>
                          <tr>
                              <th></th>
                              <th>Node</th>
                              <th>Message</th>
                              <th>Time</th>
                          </tr>
                      </thead>
                      <tbody>
                          {% for alert in current_alerts %}
                          <tr class='clickable-row' data-href="/alert/alerts/">
                              <td><i class="fa fa-warning fa-fw" style="color:{% if alert.level == 'high'%} red {% elif alert.level == 'medium'%}orange {% else %} none {% endif %} ;"></i></td>
                              <td>{{ alert.node.hostname}}</td>
                              <td>{{ alert.descr }}</td>
                              <td><em>{{ alert.time_stamp }}</em></td>
                          </tr>
                          {% endfor %}
 
                      </tbody>
                  </table>
              </div>
              <!-- /.table-responsive -->
              <a href="/alert/alerts/" class="btn btn-default btn-block">View All Alerts</a>
          </div>
          <!-- /.panel-body -->
      </div>
      <!-- /.panel -->
  </div>
    <!-- /.col-lg-6 -->
    <div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i> System Alerts
                <div class="pull-right">
                    <div class="btn-group">
                        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                            Actions
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu pull-right" role="menu" id='days-dd'>
                            <li><a href="#">Show Last 14 Days</a>
                            </li>
                            <li><a href="#">Show Last 30 Days</a>
                            </li>
                            <li><a href="#">Show Last 60 Days</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div id="morris-area-chart"></div>
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
    </div>
    <!-- /.col-lg-6 -->
</div>
<!-- /.row -->

{% endblock page-content %}

{% block script %}

    <script type="application/javascript">
      
      var alerts_by_day = {{ alerts_by_day|safe }};
      var morris_data = [{{ morris_data|safe }} ];
      
      
      
      function update_alert_chart( number_of_days)
      {
          // get data for the days selected
          var the_data = morris_data.slice(0, number_of_days);
          
          // clear any existing data from the chart area.
          $('#morris-area-chart').empty()
          
          //populate chart with new data
          Morris.Area({
            element: 'morris-area-chart',
            data: the_data,
            xkey: 'period',
            ykeys: ['alerts'],
            labels: ['Alerts'],
            pointSize: 2,
            hideHover: 'auto',
            resize: true
          });           
      
      };   

        $(document).ready(function() {
            if (Cookies.get('fade-page-in') != undefined) {
                $('body').css('display', 'none');
                $('body').fadeIn(600);
                Cookies.remove('fade-page-in', { path: '/' });
            }
            
            update_alert_chart(14);
 
        });
        
  // days drop down
  $("#days-dd li a").click(function(){
    var number_of_days;
    
    if( $(this).text().indexOf('14') != -1)
    {
       number_of_days = 14;
    }
    else if (  $(this).text().indexOf('30') != -1)
    {
       number_of_days = 30; 
    }
    else if (  $(this).text().indexOf('60') != -1)
    {
       number_of_days = 60; 
    }    
      
    update_alert_chart( number_of_days );
  });    

    </script>

{% endblock script %}
